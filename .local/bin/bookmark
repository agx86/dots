#!/bin/bash

# Function to check if a string is a valid URL
is_valid_url() {
    # Using grep with regex to check if the string matches the URL pattern
    echo "$1" | grep -E -q '^https?://[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,})?(:[0-9]{1,5})?(/\S*)?$'
}

# Function to check if tags are valid
are_valid_tags() {
    # Using grep with regex to check if the string contains only alphanumeric characters and spaces
    echo "$1" | grep -q '^[a-zA-Z0-9 ]*$'
}

# Prompt for bookmark
bookmark=$(printf '' | dmenu -p "Insert Link:")
#bookmark=$(xclip -o)
file="$HOME/backup/notes/links.txt"

# Check if bookmark is empty
if [ -z "$bookmark" ]; then
    notify-send "No URL provided"
    exit 1
fi

# Check if bookmark is a valid URL
if ! is_valid_url "$bookmark"; then
    notify-send "Invalid URL: $bookmark"
    exit 1
fi

# Check if bookmark already exists
if grep -Fxq "$bookmark" "$file"; then
    notify-send "Bookmark already present: $bookmark"
    exit 1
fi

# Prompt for tags
tags=$(printf '' | dmenu -p "Insert Tags (separate with spaces):")

# Check if tags are empty
if [ -z "$tags" ]; then
    notify-send "No tags provided"
    exit 1
fi

# Check if tags are valid
if ! are_valid_tags "$tags"; then
    notify-send "Invalid tags: $tags"
    exit 1
fi

# Add tags to bookmark and append to file
tags_with_prefix=$(echo "$tags" | sed 's/\s\+/#/g;s/^/#/;s/#/ #/g')
echo "Added $bookmark with tags $tags_with_prefix"
echo "$bookmark $tags_with_prefix" >> "$file" 
notify-send "Bookmark added: $bookmark with tags: $tags"

